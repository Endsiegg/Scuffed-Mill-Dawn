PER_scripted_effect_update_principalists_popularity_variable = {
	hidden_effect = {
		set_temp_variable = { principalists_pop = party_pop_array^9 }
		set_temp_variable = { reformists_pop = party_pop_array^8 }
		set_temp_variable = { sum_parties = principalists_pop }
		add_to_temp_variable = { sum_parties = reformists_pop }
		set_temp_variable = { temp_var_hundred = 100 }
		divide_temp_variable = { temp_var_hundred = sum_parties }
		multiply_temp_variable = { principalists_pop = temp_var_hundred }
		set_variable = {
			principalists_popularity_percent = principalists_pop
		}
		set_temp_variable = { reformists_popularity_temp_variable = principalists_popularity_percent }
		set_temp_variable = { number100 = 100 }
		subtract_from_temp_variable = {
			var = number100
			value = reformists_popularity_temp_variable
		}
		set_variable = {
			reformists_popularity_percent = number100
		}

		#Round variables to display
		set_variable = {
			principalists_popularity_percent_round = principalists_popularity_percent
		}
		round_variable = principalists_popularity_percent_round
		set_variable = {
			reformists_popularity_percent_round = reformists_popularity_percent
		}
		round_variable = reformists_popularity_percent_round
	}
}
PER_scripted_effect_finish_election = {
	hidden_effect = {
		clr_country_flag = PER_election_enabled
		clr_country_flag = principalist_portrait_ahmadinejad
		clr_country_flag = principalist_portrait_raisi
		clr_country_flag = principalist_portrait_tavakoli
		clr_country_flag = principalist_portrait_ghalibaf
		clr_country_flag = principalist_portrait_rezaee
		clr_country_flag = reformist_portrait_hemmati
		clr_country_flag = reformist_portrait_khatami
		clr_country_flag = reformist_portrait_mousavi
		clr_country_flag = reformist_portrait_rafsanjani
		clr_country_flag = reformist_portrait_rouhani
		remove_ideas = {
			PER_ahmadinejad_idea
			PER_ghalibaf_idea
			PER_hemmati_idea
			PER_khatami_idea
			PER_mousavi_idea
			PER_rafsanjani_idea
			PER_raisi_idea
			PER_rezaee_idea
			PER_rouhani_idea
			PER_tavakoli_idea
		}
		if = {
			limit = {
				date > 2001.1.1
				date < 2002.1.1
			}
			set_politics = {
				ruling_party = communism # Reset ruling ideology to Emerging
				elections_allowed = yes
				last_election = "2001.6.8"
				election_frequency = 48
			}
		}
		else_if = {
			limit = {
				date > 2005.1.1
				date < 2006.1.1
			}
			set_politics = {
				ruling_party = communism # Reset ruling ideology to Emerging
				elections_allowed = yes
				last_election = "2005.6.17"
				election_frequency = 48
			}
		}
		else_if = {
			limit = {
				date > 2009.1.1
				date < 2010.1.1
			}
			set_politics = {
				ruling_party = communism # Reset ruling ideology to Emerging
				elections_allowed = yes
				last_election = "2009.6.12"
				election_frequency = 48
			}
		}
		else_if = {
			limit = {
				date > 2013.1.1
				date < 2014.1.1
			}
			set_politics = {
				ruling_party = communism # Reset ruling ideology to Emerging
				elections_allowed = yes
				last_election = "2013.6.14"
				election_frequency = 47
			}
		}
		else_if = {
			limit = {
				date > 2017.1.1
				date < 2018.1.1
			}
			set_politics = {
				ruling_party = communism # Reset ruling ideology to Emerging
				elections_allowed = yes
				last_election = "2017.5.19"
				election_frequency = 48
			}
		}
		else_if = {
			limit = {
				date > 2021.1.1
				date < 2022.1.1
			}
			set_politics = {
				ruling_party = communism # Reset ruling ideology to Emerging
				elections_allowed = yes
				last_election = "2021.6.18"
				election_frequency = 48
			}
		}
		
		create_country_leader = { # Reset country leader
			name = "Sayyid Ali Hosseini Khamenei"
			picture = "sayyid_ali_hosseini_khamenei.dds"
			ideology = Vilayat_e_Faqih
			traits = {
				emerging_Vilayat_e_Faqih
				cleric
				geopolitical_thinker
				political_dancer
				stubborn
				anti_zionist
			}
		}
		remove_mission = PER_auto_update_gui_weekly
	}
}
#PER_set_state_protest_level = { # Sets activity percentage level to zero
#	hidden_effect = {
#		# Percentage 1-100
#		set_variable = { azerbaijan_activity_percent = 0 min = 0 max = 100}
#		set_variable = { fars_activity_percent = 0 min = 0 max = 100}
#		set_variable = { gilan_activity_percent = 0 min = 0 max = 100}
#		set_variable = { greater_khorasan_activity_percent = 0 min = 0 max = 100}
#		set_variable = { greater_luristan_activity_percent = 0 min = 0 max = 100}
#		set_variable = { hormuzgan_activity_percent = 0 min = 0 max = 100}
#		set_variable = { isfahan_activity_percent = 0 min = 0 max = 100}
#		set_variable = { kavir_activity_percent = 0 min = 0 max = 100}
#		set_variable = { khoy_activity_percent = 0 min = 0 max = 100}
#		set_variable = { khuzestan_activity_percent = 0 min = 0 max = 100}
#		set_variable = { kordestan_activity_percent = 0 min = 0 max = 100}
#		set_variable = { mazandaran_activity_percent = 0 min = 0 max = 100}
#		set_variable = { qom_markazi_activity_percent = 0 min = 0 max = 100}
#		set_variable = { sistan_and_baluchistan_activity_percent = 0 min = 0 max = 100}
#		set_variable = { tehran_semnan_activity_percent = 0 min = 0 max = 100}
#		set_variable = { west_azerbaijan_activity_percent = 0 min = 0 max = 100 }
#	}
#}
PER_IRGC_activity_reformists = {
	hidden_effect = {
		if = {
			limit = { emerging_moderate_shiite_are_in_power = yes }
			add_political_power = -25
		}
	}
	if = {
		limit = { emerging_moderate_shiite_are_in_power = yes }
		custom_effect_tooltip = PER_IRGC_activity_reformists_tt
	}
}